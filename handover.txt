# SwitchRadar Handover Documentation

## Project Overview
SwitchRadar has been upgraded from a simple frontend-only tracker to a Full-Stack Business Intelligence platform. It is designed to handle thousands of business records with geospatial visualization and visit route planning.

## Key Refactorings Done
1. **Separation of Concerns**: Main application logic has been moved from `App.tsx` into custom hooks:
   - `useBusinessData.ts`: Handles data fetching (Dexie), search filtering, and cloud loading.
   - `useCloudSync.ts`: Manages background synchronization with the Node.js API.
2. **Performance Optimizations**:
   - Leaflet is now configured to use `preferCanvas: true`, which significantly improves rendering for 2000+ pins.
   - `MarkerClusterGroup` uses `chunkedLoading` and `removeOutsideVisibleBounds: true`.
   - **Map Bounds**: Restricted view to South Africa (Cape Point to Limpopo) to prevents panning issues.
   - **Clustering**: Tuned `disableClusteringAtZoom: 17` and `spiderfyDistanceMultiplier: 1` for optimal mobile performance.
3. **UI Improvements**:
   - Removed map popups in favor of a dedicated Right Sidebar.
   - Added a "Details" tab handle on the map for quick access when the sidebar is closed.
   - Minimized table view for high-density business management.

## Backend & Persistence
- **Backend**: Node.js/Express server in `/server`.
- **Database**: SQLite (`/server/data/switchradar.db`).
- **Sync Pattern**: Debounced POST requests to `/api/leads/sync` and `/api/route/sync`.

## Critical Files
- `src/App.tsx`: Main entry point and layout shell.
- `src/hooks/useBusinessData.ts`: Central data engine.
- `src/utils/phoneUtils.ts`: Logic for identifying Landline vs Mobile providers (MTN, Vodacom, etc).
- `src/components/BusinessMap.tsx`: High-performance mapping component.

## Maintenance Notes
- **To add a new provider color**: Update `src/utils/providerColors.ts`.
- **To change sync behavior**: Adjust the timer in `src/hooks/useCloudSync.ts`.
- **To modify SQLite schema**: The schema is automatically initialized in `server/db/index.js`.

## Deployment
The app is configured for Dokploy. Ensure you map a volume to `/app/data` in the Docker container to persist the SQLite database across redeploys.

---
*Created January 2026 - Advanced Agentic Coding Session*
